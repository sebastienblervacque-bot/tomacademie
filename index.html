<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acad√©mie des Sommets - 5√®me</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #09090b; --card: #18181b; --accent: #3b82f6;
            --success: #10b981; --text: #f4f4f5; --gold: #fbbf24;
            --danger: #ef4444;
        }

        body {
            font-family: 'Poppins', sans-serif; background-color: var(--bg);
            color: var(--text); margin: 0; display: flex; justify-content: center;
            min-height: 100vh;
        }

        #app-container { width: 100%; max-width: 500px; padding: 20px; }
        .hidden { display: none !important; }

        .card {
            background: var(--card); border: 1px solid #27272a;
            border-radius: 24px; padding: 20px; margin-bottom: 20px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
        }

        button {
            background: var(--accent); color: white; border: none;
            padding: 16px; border-radius: 16px; cursor: pointer;
            font-weight: 600; transition: all 0.2s; width: 100%; margin-top: 10px;
        }

        button:active { transform: scale(0.96); }
        .btn-papa { background: #f97316; border-bottom: 4px solid #c2410c; margin-top: 20px;}
        .btn-subject { background: #27272a; text-align: left; border: 1px solid #3f3f46; margin-top: 8px;}
        .btn-reset { background: transparent; border: 1px solid #3f3f46; color: #71717a; font-size: 0.8rem; margin-top: 30px; }

        .xp-bar-container { background: #27272a; height: 10px; border-radius: 5px; overflow: hidden; margin: 10px 0; }
        .xp-fill { background: linear-gradient(90deg, var(--gold), #f59e0b); width: 0%; height: 100%; transition: 1s ease; }

        .mood-btn { font-size: 2.5rem; background: none; border: none; cursor: pointer; padding: 10px; }
        
        input {
            width: 100%; padding: 15px; border-radius: 12px; border: 1px solid #3f3f46; 
            background: #09090b; color: white; box-sizing: border-box; margin-bottom: 10px;
        }

        #game-canvas { background: #000; border-radius: 20px; border: 2px solid var(--gold); width: 100%; touch-action: none; }
    </style>
</head>
<body>

<div id="app-container">
    <div id="screen-setup" class="card hidden">
        <h1>Bienvenue Champion</h1>
        <p>Pr√™t pour ton ascension ?</p>
        <input type="text" id="in-name" placeholder="Ton pr√©nom">
        <button onclick="saveProfile()">Cr√©er mon profil</button>
    </div>

    <div id="screen-mood" class="card hidden" style="text-align: center;">
        <h2 id="mood-greeting">Salut !</h2>
        <p>Comment te sens-tu pour tes d√©fis aujourd'hui ?</p>
        <div style="display: flex; justify-content: center; gap: 10px;">
            <button class="mood-btn" onclick="logMood('üöÄ', '√Ä fond !')">üöÄ</button>
            <button class="mood-btn" onclick="logMood('üéØ', 'Concentr√©')">üéØ</button>
            <button class="mood-btn" onclick="logMood('üò¥', 'Fatigu√©')">üò¥</button>
            <button class="mood-btn" onclick="logMood('ü§î', 'Incertain')">ü§î</button>
        </div>
    </div>

    <div id="screen-goal" class="card hidden">
        <h2>Ton Objectif Hebdo</h2>
        <p>Combien d'XP veux-tu atteindre cette semaine ?</p>
        <input type="number" id="in-goal" placeholder="Ex: 200">
        <button onclick="saveGoal()">Valider mon contrat</button>
    </div>

    <div id="screen-main" class="hidden">
        <div class="card">
            <h2 id="txt-greeting" style="margin:0;">Salut !</h2>
            <p id="txt-mood" style="font-style: italic; color: var(--success); margin: 5px 0;"></p>
            
            <div style="margin-top: 15px;">
                <span style="font-size: 0.8rem;">Objectif de la semaine : <b id="goal-val">0</b> XP</span>
                <div class="xp-bar-container"><div id="goal-fill" class="xp-fill"></div></div>
            </div>
            
            <p style="font-size: 0.8rem; opacity: 0.8;">Score Total : <span id="xp-total" style="color:var(--gold); font-weight:bold;">0</span> XP</p>
            <button class="btn-papa" onclick="shareWithPapa()">‚≠ê Envoyer mon score √† Papa</button>
        </div>

        <div style="display: grid; grid-template-columns: 1fr; gap: 10px;">
            <button class="btn-subject" onclick="showSection('section-quiz')">üìù <b>Quiz du jour</b> (R√©els 5√®me)</button>
            <button class="btn-subject" onclick="showSection('section-import')">üì∏ <b>R√©viser mes cours</b></button>
        </div>

        <div id="section-quiz" class="section hidden card">
            <h3 style="color:var(--gold);">D√©fis 5√®me</h3>
            <div id="quiz-content">
                <button class="btn-subject" onclick="startQuiz('maths')">üìê Maths : Relatifs & Fractions</button>
                <button class="btn-subject" onclick="startQuiz('anglais')">üá¨üáß Anglais : Le Pr√©t√©rit</button>
                <button class="btn-subject" onclick="startQuiz('espagnol')">üá™üá∏ Espagnol : Pr√©sent & Famille</button>
            </div>
            <button onclick="closeSections()" style="background:#333; margin-top:20px;">Retour</button>
        </div>

        <div id="section-game" class="section hidden card" style="text-align:center;">
            <h3 style="color:var(--gold);">CADEAU ! üéÅ</h3>
            <canvas id="game-canvas" width="300" height="400"></canvas>
            <p id="game-score">Score : 0 / 10</p>
            <button onclick="closeSections()" style="background:#333">Quitter le jeu</button>
        </div>

        <div id="section-import" class="section hidden card">
            <h3>Tes cours</h3>
            <input type="file" accept="image/*" onchange="handleFile(event)">
            <div id="file-preview"></div>
            <button onclick="closeSections()" style="background:#333; margin-top:20px;">Retour</button>
        </div>

        <button class="btn-reset" onclick="fullReset()">R√©initialiser mon Acad√©mie</button>
    </div>
</div>

<script>
    let state = { name: "", xp: 0, goal: 0, mood: "" };

    const dbQuiz = {
        maths: [
            { q: "Calcule : (-12) + (+4)", a: ["-16", "-8", "8"], correct: 1 },
            { q: "Simplifie 20/30", a: ["2/3", "4/6", "1/2"], correct: 0 }
        ],
        anglais: [
            { q: "Pr√©t√©rit de 'SEE' (Voir) :", a: ["Seed", "Saw", "Seen"], correct: 1 },
            { q: "Traduction de 'Last night' :", a: ["La nuit derni√®re", "Tard le soir", "Demain soir"], correct: 0 }
        ],
        espagnol: [
            { q: "Comment dit-on 'Ma grand-m√®re' ?", a: ["Mi madre", "Mi t√≠a", "Mi abuela"], correct: 2 },
            { q: "Yo ____ (ESTAR) en casa.", a: ["Estoy", "Est√°s", "Est√°"], correct: 0 }
        ]
    };

    window.onload = () => {
        const saved = localStorage.getItem('sommets_user');
        if (saved) {
            state = JSON.parse(saved);
            showMoodScreen();
        } else {
            document.getElementById('screen-setup').classList.remove('hidden');
        }
    };

    function saveProfile() {
        state.name = document.getElementById('in-name').value;
        if (!state.name) return;
        saveData();
        showMoodScreen();
    }

    function showMoodScreen() {
        document.getElementById('screen-setup').classList.add('hidden');
        document.getElementById('screen-mood').classList.remove('hidden');
        document.getElementById('mood-greeting').innerText = `Salut ${state.name} !`;
    }

    function logMood(emoji, txt) {
        state.mood = emoji + " " + txt;
        document.getElementById('screen-mood').classList.add('hidden');
        if (state.goal > 0) showDashboard();
        else document.getElementById('screen-goal').classList.remove('hidden');
    }

    function saveGoal() {
        state.goal = parseInt(document.getElementById('in-goal').value);
        if (state.goal > 0) {
            saveData();
            showDashboard();
        }
    }

    function showDashboard() {
        document.getElementById('screen-goal').classList.add('hidden');
        document.getElementById('screen-main').classList.remove('hidden');
        document.getElementById('txt-greeting').innerText = `En avant, ${state.name} !`;
        document.getElementById('txt-mood').innerText = `Humeur : ${state.mood}`;
        refreshUI();
    }

    function refreshUI() {
        document.getElementById('xp-total').innerText = state.xp;
        document.getElementById('goal-val').innerText = state.goal;
        let progress = (state.xp / state.goal) * 100;
        document.getElementById('goal-fill').style.width = Math.min(progress, 100) + "%";
        saveData();
    }

    function fullReset() {
        if (confirm("Attention Champion ! Cela va effacer tes points, ton pr√©nom et ton objectif. Es-tu s√ªr de vouloir recommencer √† z√©ro ?")) {
            localStorage.clear();
            location.reload();
        }
    }

    function startQuiz(sub) {
        const qData = dbQuiz[sub][Math.floor(Math.random() * dbQuiz[sub].length)];
        let html = `<h4>${qData.q}</h4>`;
        qData.a.forEach((opt, i) => {
            html += `<button class="btn-subject" onclick="checkAnswer(${i}, ${qData.correct})">${opt}</button>`;
        });
        document.getElementById('quiz-content').innerHTML = html;
    }

    function checkAnswer(chosen, correct) {
        if (chosen === correct) {
            state.xp += 40;
            refreshUI();
            alert("BRAVO ! +40 XP.");
            showSection('section-game');
            initGame();
        } else {
            alert("Presque ! Relis bien.");
        }
        document.getElementById('quiz-content').innerHTML = `
            <button class="btn-subject" onclick="startQuiz('maths')">üìê Maths</button>
            <button class="btn-subject" onclick="startQuiz('anglais')">üá¨üáß Anglais</button>
            <button class="btn-subject" onclick="startQuiz('espagnol')">üá™üá∏ Espagnol</button>`;
    }

    function shareWithPapa() {
        const msg = `Salut Papa ! Mon moral est ${state.mood}. J'ai ${state.xp} XP sur mon objectif de ${state.goal} ! üöÄ`;
        window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`, '_blank');
    }

    function showSection(id) {
        document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
    }

    function closeSections() {
        document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
    }

    function handleFile(event) {
        const reader = new FileReader();
        reader.onload = (e) => {
            document.getElementById('file-preview').innerHTML = `<img src="${e.target.result}" style="width:100%; border-radius:15px; margin-top:10px;">`;
        };
        reader.readAsDataURL(event.target.files[0]);
    }

    function saveData() { localStorage.setItem('sommets_user', JSON.stringify(state)); }

    // --- MINI JEU ---
    function initGame() {
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        let basket = { x: 125, y: 350, w: 50, h: 15 };
        let star = { x: Math.random()*270, y: 0, r: 10, s: 5 };
        let caught = 0;

        function play() {
            ctx.clearRect(0, 0, 300, 400);
            ctx.fillStyle = "#3b82f6"; ctx.fillRect(basket.x, basket.y, basket.w, basket.h);
            ctx.fillStyle = "#fbbf24"; ctx.beginPath(); ctx.arc(star.x, star.y, star.r, 0, 7); ctx.fill();
            star.y += star.s;
            if(star.y > 400) { star.y = 0; star.x = Math.random()*270; }
            if(star.y > basket.y && star.x > basket.x && star.x < basket.x + basket.w) {
                caught++;
                document.getElementById('game-score').innerText = `Score : ${caught} / 10`;
                star.y = 0; star.x = Math.random()*270;
            }
            if(caught < 10) requestAnimationFrame(play);
            else { ctx.fillStyle="white"; ctx.fillText("OBJECTIF ATTEINT !", 80, 200); }
        }
        canvas.onmousemove = (e) => {
            let rect = canvas.getBoundingClientRect();
            basket.x = (e.clientX - rect.left) * (300 / rect.width) - 25;
        };
        canvas.ontouchmove = (e) => {
            let rect = canvas.getBoundingClientRect();
            basket.x = (e.touches[0].clientX - rect.left) * (300 / rect.width) - 25;
        };
        play();
    }
</script>
</body>
</html>